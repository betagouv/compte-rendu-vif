generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/backend-client"
}

generator typebox {
  provider = "prisma-typebox-generator"
  output   = "../src/generated/typebox"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model atdatabases_migrations_applied {
  id            BigInt   @id @default(autoincrement())
  index         Int
  name          String
  script        String
  applied_at    DateTime @db.Timestamptz(6)
  ignored_error String?
  obsolete      Boolean
}

model atdatabases_migrations_version {
  id      Int     @id
  version String?
}

model clause {
  id               String             @id
  label            String
  value            String
  report_to_clause report_to_clause[]
}

model report {
  id                    String             @id
  title                 String?
  project_description   String?
  redacted_by           String?
  meet_date             DateTime?          @db.Timestamp(6)
  applicant_name        String?
  applicant_address     String?
  project_cadastral_ref String?
  project_space_type    String?
  decision              String?
  precisions            String?
  contacts              String?
  further_information   String?
  created_by_id         String
  created_by_username   String
  created_at            DateTime           @db.Timestamp(6)
  service_instructeur   String?
  report_to_clause      report_to_clause[]
}

model report_to_clause {
  id        String @id
  report_id String
  clause_id String
  clause    clause @relation(fields: [clause_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  report    report @relation(fields: [report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model chip {
  key     String
  value   String
  udap_id String
  text    String

  @@id([key, value, udap_id])
}

model delegation {
  createdBy                         String
  delegatedTo                       String
  user_delegation_createdByTouser   user   @relation("delegation_createdByTouser", fields: [createdBy], references: [email], onDelete: Cascade, onUpdate: NoAction)
  user_delegation_delegatedToTouser user   @relation("delegation_delegatedToTouser", fields: [delegatedTo], references: [email], onDelete: Cascade, onUpdate: NoAction)

  @@id([createdBy, delegatedTo])
}

model udap {
  id              String   @id
  department      String
  complete_coords String?
  visible         Boolean?
  name            String?
  address         String?
  zip_code        String?
  city            String?
  phone           String?
  email           String?
  user            user[]
}

model user {
  email                                   String       @id
  name                                    String
  temporaryLink                           String?
  temporaryLinkExpiresAt                  String?
  password                                String
  udap_id                                 String
  delegation_delegation_createdByTouser   delegation[] @relation("delegation_createdByTouser")
  delegation_delegation_delegatedToTouser delegation[] @relation("delegation_delegatedToTouser")
  udap                                    udap         @relation(fields: [udap_id], references: [id], onDelete: SetNull, onUpdate: NoAction, map: "fk_udap_id")
}
